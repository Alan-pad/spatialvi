---
title: "Clustering Spatial Transcriptomics data"
format:
  html:
    code-fold: true
jupyter: python3
---

```{python}
#| tags: [parameters]
#| echo: false

fileNameST = ""
numberOfColumns = 5
saveDEFileName = ""
saveSpatialDEFileName = ""
plotTopHVG = 15
```

```{python}
#| echo: false
# Hide warnings in output html.
# Load packages
import argparse
import scanpy as sc
import pandas as pd
import SpatialDE

# Main script
# See more settings at:
# https://scanpy.readthedocs.io/en/stable/generated/scanpy._settings.ScanpyConfig.html
st_adata = sc.read(fileNameST)
print(st_adata.shape)

counts = pd.DataFrame(st_adata.X.todense(), columns=st_adata.var_names, index=st_adata.obs_names)
coord = pd.DataFrame(st_adata.obsm["spatial"], columns=["x_coord", "y_coord"], index=st_adata.obs_names)

df_results = SpatialDE.run(coord, counts)

df_results.index = df_results["g"]
df_results = df_results.sort_values("qval", ascending=True)

df_results.to_csv(saveSpatialDEFileName)

# Plotting top most-HVG
keys = df_results.index.values[: plotTopHVG]
sc.pl.spatial(st_adata, img_key="hires", color=keys, alpha=0.7, ncols=numberOfColumns)
```